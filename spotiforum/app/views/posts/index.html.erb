<p id="notice"><%= notice %></p>

<h1>Posts</h1>

<%= form_tag posts_path, method: :get do %>
  <div class="form-check">
      <%= radio_button_tag :sort_by, 'created_at_desc', params[:sort_by] == 'created_at_desc' %>
      <%= label_tag :sort_by_created_at, "Dal piÃ¹ recente" %>
  </div>
  <div class="form-check">
      <%= radio_button_tag :sort_by, 'created_at', params[:sort_by] == 'created_at' %>
      <%= label_tag :sort_by, "Dal meno recente" %>
  </div>
  <div class="form-check">
      <%= radio_button_tag :sort_by, 'likes', params[:sort_by] == 'likes' %>
      <%= label_tag :sort_by, "Numero di Like" %>
  </div>
  <div class="form-check">
      <%= radio_button_tag :sort_by, 'comments', params[:sort_by] == 'comments' %>
      <%= label_tag :sort_by, "Numero di Commenti" %>
  </div>
  <div class="form-check">
  <%= check_box_tag :filter_favourite, 1, params[:filter_favourite].present? %>
      <%= label_tag :filter, "Preferiti" %>
  </div>
      <%= submit_tag 'Ordina', class: 'btn btn-primary btn_submit' %>
<% end %>


  <div class="add_post">
  <%= link_to new_post_path, id: "my-link" do %>
    <%= image_tag "add.svg", class: "btn_for_user" %>
  <% end %>
  </div>

  <% @posts.each do |post| %>
    <% @user = User.find_by(id: post.user_id) %>
    <div class="posts_container">
      <h2 class="username"> <%= @user[:name] %> </h2>
      <h3 class="content"><%= post.content %></h3>
      <h4 class="tags"><%= post.tag %></h4>

        <div class="row">

            <div class="col-sm-2 num_likes">
              <%= @likes.where(post_id: post.id).count %>
            </div>

            <div class="col-sm-2 likes">

              <!-- Rimanda al metodo like in PostController passandogli lid del post -->

              
              <!--  < if post.liked?(current_user) > -->

              <% if !user_signed_in? %>
                  <%= button_to like_path(post.id), {:class => "buttonTo" }, disabled: true, method: "put" do %>
                    <%= image_tag "like.svg", class: "btn_for_user" %>
                  <% end %>
              <%end%>
              <% if user_signed_in? %>
				<%= button_to like_path(post.id), { :id => "AddLike", :class => "buttonTo" }, method: "post" do %>
				  <%= image_tag "like.svg", class: "btn_for_user" %>
				<% end %>
              <!--  < else >
               <= link_to like_path(post.id), method: "post" do >
                <= image_tag "liked.svg", class: "btn_for_user" >
                < end > -->
              <%end%>

              
            </div>

          <% if user_signed_in? %>
            <div class="col-sm-2">
              <%= link_to new_comment_path do %>
                <%= image_tag "comment.svg", class: "btn_for_user" %>
              <% end %>
            </div>

            <div class="col-sm-8">
            <%= button_to favourite_path(post.id), {:class => "buttonTo" }, method: "post" do %>
              <%= image_tag "favourite.svg", class: "btn_for_user" %>
            <% end %>
            </div>
          <%end%>
        </div>

      <div class="toggle-comments" id="drop"> <%= image_tag "drop.svg", class: "btn_for_user"%></div>
      <div class="comments" style="display:none;">
            <% comments = @comments.where(post_id: post.id) %>
            <% comments.each do |comment| %>
              <% @user = User.find_by(id: comment.user_id) %>
              <p class="author_name"><%= @user[:name] %></p>
              <p class="comment_text"><%= comment.content %></p>
            <% end %>
      
      </div>
    </div>
  <% end %>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function(){
    $('.toggle-comments').click(function(){
      $(this).siblings('.comments').toggle();
    });
  });
</script>

